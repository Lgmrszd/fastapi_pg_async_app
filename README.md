# FastAPI + SQLALchemy + asyncpg test app

This is a simple asynchronous FastAPI application that uses SQLAlchemy ORM for data handling
and implements basic CRUD endpoints

Database calls are generated by SQLAlchemy 2.0 and handled by asyncpg

This app also includes unit tests for crud module, using Pytest library and AnyIO pytest module for async support
(installed as part of FastAPI) and testcontainers module for setting up temporary database container.

## Documentation
API documentation is available at `/docs` path, for example, http://127.0.0.1:8000/docs

## Running in Docker
### "Prod" version:
```bash
docker compose build
docker compose up
```
### Dev version (with code reload and pgAdmin container):
```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml up
```

## Preparing locally, running tests and application:
```bash
# Create a virtualenv, follow standard procedure for your system
python3 -m venv venv
source venv/bin/activate
# Install requirements, install pytest if testing is planned
pip install -r requirements.txt
pip install pytest~=7.4.0 testcontainers~=3.7.1 testcontainers-postgres
# Run tests
python -m pytest
# Run application (DB settings should be set as environment variables)
export PSQL__HOST=localhost
export PSQL__USER=postgres
 export PSQL__PASSWORD=psql_pass #do not log the password
export PSQL__DB=postgres
python -m uvicorn fastapi_pg_async_app.app:app
```


## Acknowledgments

#### Following sources were used:
Documentations:
- [Official FastAPI documentation](https://fastapi.tiangolo.com/)
- [Official SQLAlchemy documentation](https://docs.sqlalchemy.org/en/20/)
- [Official Pytest documentation](https://docs.pytest.org/en/7.1.x)

Articles:
- [Python Integration Tests: docker-compose vs testcontainers](https://medium.com/codex/python-integration-tests-docker-compose-vs-testcontainers-94986d7547ce)
- [Async SQLAlchemy with FastAPI](https://stribny.name/blog/fastapi-asyncalchemy/)